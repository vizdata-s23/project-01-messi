---
title: "The Evolution of the World Cup"
subtitle: "STA/ISS 313 - Spring 2023 - Project 1"
author: "Team Messi"
title-slide-attributes:
  data-background-image: images/watercolour_sys02_img34_teacup-ocean.jpg
  data-background-size: stretch
  data-slide-number: none
format: revealjs
editor: visual
execute:
  echo: false
---

```{r}
#| label: load-packages
#| include: false

# Add any additional packages you need to this chunk
# Remove any packages from this list that you're not using
library(tidyverse)
library(ggplot2)
```

```{r}
#| label: setup
#| include: false

# For better figure resolution
knitr::opts_chunk$set(
  fig.retina = 3, 
  dpi = 300, 
  fig.width = 6, 
  fig.asp = 0.618, 
  out.width = "70%"
  )
```

```{r}
#| label: load-data
#| include: false

wcmatches <-
  readr::read_csv(
    'https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-11-29/wcmatches.csv'
  )
worldcups <-
  readr::read_csv(
    'https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-11-29/worldcups.csv'
  )
penalties <-
  readr::read_csv("data/penalties_stats_aa.csv") #external data from kaggle
```

```{r, echo = FALSE}
#| label: merge-data
#| include: false

world_cup_total <- wcmatches |>
  left_join(worldcups, by = "year")

world_cup_total <- penalties %>%
  select(-Host) %>%
  rename('year' = "Year") %>%
  left_join(world_cup_total, penalties, by = 'year')
```

```{r}
#| label: new-variables
#| include: false
penalties2022 <- data.frame(2022, "Qatar", 64, 17, 23, 5, 1)
names(penalties2022) <-
  c(
    "Year",
    "Host",
    "MatchesPlayed",
    "PenaltiesScored",
    "PenaltiesAwarded",
    "PenaltiesSaved",
    "PenaltiesMissed"
  )

penaltiesnew <- rbind(penalties, penalties2022)


world_cup_total <- world_cup_total |>
  mutate(
    goalspergame = goals_scored / games,
    attendancepergame = attendance / games,
    gamesperteam = games / teams
  )

penaltiesnew <- penaltiesnew |>
  mutate(
    penaltiespergame = PenaltiesAwarded / MatchesPlayed,
    penaltymakepercentage = PenaltiesScored / PenaltiesAwarded
  )

names(penaltiesnew)[names(penaltiesnew) == "Year"] <- "year"

penaltieswgoalsnew <-
  merge(penaltiesnew, worldcups, by = "year", all.x = TRUE)
penaltieswgoalsnew$goals_scored[is.na(penaltieswgoalsnew$goals_scored)] <-
  172
penaltieswgoalsnew <- penaltieswgoalsnew |>
  mutate(
    propgoalsthatarepens = PenaltiesScored / goals_scored,
    goalspergame = goals_scored / MatchesPlayed
  )
```

## Introduction

-   Introduction

-   Introduction

## Q1: The Effect of New Rules on Goals Scored

-   The rules in the World Cup have changed a lot over time (# of teams, VAR, penalties, etc.)

-   How has this affected the goal scoring in World Cup games throughout time?

    ::: columns
    ::: {.column width="50%"}
    Plot 1

    -   scatterplot with goals per game each tournament
    -   annotate years with new rules and events
    :::

    ::: {.column width="50%"}
    Plot 2

    -   line graph showing penalties per game and proportion of goals that are penalties
    :::
    :::

## Goals per game across World Cups

```{r}
#| label: q1-plot1-dataprep
#| echo: false

q1 <- world_cup_total |>
  add_row(year = 1942,
          goalspergame = 0,
          country = "Germany") |>
  add_row(year = 1946,
          goalspergame = 0,
          country = "Brazil") |>
  mutate(
    new_rule = case_when(year %in% c(1970, 1982, 1998, 2014, 2018) ~ "Yes",
                         TRUE ~ "No"),
    event = case_when(year %in% c(1942, 1946, 1954, 1966, 1978) ~ "Yes",
                      TRUE ~ "No")
  ) |>
  group_by(year, goalspergame)
```

```{r}
#| label: q1-plot1
#| echo: false
ggplot(q1, aes(
  x = year,
  y = goalspergame,
  color = new_rule,
  shape = event
)) +
  geom_point(size = 2) +
  scale_x_continuous(breaks = seq(1930, 2018, by = 8)) +
  theme_minimal() +
  scale_color_manual(values = c("#A80040", "#1077C3")) +
  scale_shape_manual(values = c(16, 8)) +
  labs(
    title = "Goals per game have decreased over time",
    subtitle = "For World Cups 1930-2018",
    x = "Year",
    y = "Goals per game",
    color = "New rule",
    shape = "Notable event"
  ) +
  annotate(
    geom = "text",
    label = "1942, 1946: cancelled \ndue to WWII",
    x = 1944,
    y = 0.5,
    size = 2.5,
    color = "#A80040"
  ) +
  annotate(
    geom = "text",
    label = "1954: most goals by\na country (Hungary, 27)",
    x = 1949,
    y = 5,
    size = 2.5,
    color = "#A80040"
  ) +
  annotate(
    geom = "text",
    label = "1966: first hattrick\nin a World Cup final",
    x = 1958,
    y = 2.4,
    size = 2.5,
    color = "#A80040"
  ) +
  annotate(
    geom = "text",
    label = "1978: hardest World\nCup to qualify for",
    x = 1982,
    y = 5.1,
    size = 2.5,
    color = "#A80040"
  ) +
  geom_segment(aes(
    x = 1978,
    y = 2.68,
    xend = 1978,
    yend = 4.8
  ),
  color = "#A80040") +
  annotate(
    geom = "text",
    label = "1970: penalties introduced",
    x = 1970,
    y = 1.6,
    size = 2.5,
    color = "#1077C3"
  ) +
  geom_segment(aes(
    x = 1970,
    y = 3,
    xend = 1970,
    yend = 1.8
  ),
  color = "#1077C3") +
  annotate(
    geom = "text",
    label = "1982: 16 to 24 teams\n1998: 24 to 32 teams",
    x = 1998,
    y = 4,
    size = 2.5,
    color = "#1077C3"
  ) +
  geom_segment(aes(
    x = 1982,
    y = 2.8,
    xend = 1998,
    yend = 3.7
  ),
  color = "#1077C3") +
  geom_segment(aes(
    x = 1998,
    y = 2.7,
    xend = 1998,
    yend = 3.7
  ),
  color = "#1077C3") +
  annotate(
    geom = "text",
    label = "2014: goal line technology\n2018: VAR introduced",
    x = 2006,
    y = 1,
    size = 2.5,
    color = "#1077C3"
  ) +
  geom_segment(aes(
    x = 2014,
    y = 2.7,
    xend = 2010,
    yend = 1.3
  ),
  color = "#1077C3") +
  geom_segment(aes(
    x = 2018,
    y = 2.6,
    xend = 2010,
    yend = 1.3
  ),
  color = "#1077C3")
```

## Observations

-   The introduction of and increasing the number of teams did not affect goal scoring overall
-   Technology implementations in 2014 and 2018 increased goals scored per game

## Plot and text

::: columns
::: {.column width="50%"}
-   Some text
-   goes here
:::

::: {.column width="50%"}
```{r}
#| warning: false
#| out-width: "100%"
#| fig-width: 4
#| echo: false

# See how I changed out-width and fig-width from defaults
# to make the figure bigger
```
:::
:::

# A new section...

## Tables

If you want to generate a table, make sure it is in the HTML format (instead of Markdown or other formats), e.g.,

```{r}
#| label: penguins-table

#gt(head(penguins))
```

## Images

![Image credit: Danielle Navarro, Percolate.](images/watercolour_sys02_img34_teacup-ocean.png)

## Math Expressions {.smaller}

You can write LaTeX math expressions inside a pair of dollar signs, e.g. \$\alpha+\beta\$ renders $\alpha+\beta$. You can use the display style with double dollar signs:

    $$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$

$$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$

Limitations:

1.  The source code of a LaTeX math expression must be in one line, unless it is inside a pair of double dollar signs, in which case the starting `$$` must appear in the very beginning of a line, followed immediately by a non-space character, and the ending `$$` must be at the end of a line, led by a non-space character;

2.  There should not be spaces after the opening `$` or before the closing `$`.

# Wrap up

## Feeling adventurous?

-   You are welcomed to use the default styling of the slides. In fact, that's what I expect majority of you will do. You will differentiate yourself with the content of your presentation.

-   But some of you might want to play around with slide styling. Some solutions for this can be found at https://quarto.org/docs/presentations/revealjs.
