{
  "hash": "54eb6fa5f5ea93981c471adf2b42eb36",
  "result": {
    "markdown": "---\noutput: html_document\neditor_options: \n  chunk_output_type: console\n---\n\n\n### Load Packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(ggplot2)\n```\n:::\n\n\n### Load Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwcmatches <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-11-29/wcmatches.csv')\nworldcups <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-11-29/worldcups.csv')\npenalties <- readr::read_csv(\"data/penalties_stats_aa.csv\") #external data from kaggle\n```\n:::\n\n\n#### Merge Data\n\n\n::: {.cell}\n\n:::\n\n\n#### New Variables\n\n\n::: {.cell}\n\n:::\n\n\n## Question 1\n\n**scatterplot showing the number of goals scored per game of each world cup**\n\n**x-axis will be `year` and the y-axis will be the average `goals_scored` per game of that world cup**.\n\n**annotations on top of this graph to show when certain changes were implemented in the World Cup**,\n\n**may add another variable such as continent (color) in order to see if the if the power rankings across the world have shifted over time**\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Code_files/figure-html/q1-plot1-1.png){width=672}\n:::\n:::\n\n\n## Question 2\n\n\n::: {.cell}\n\n```{.r .cell-code}\nq2 <- wcmatches %>%\n  pivot_longer(c(home_team, away_team)) %>%\n  rename(home_away = name,\n         team = value)\n```\n:::\n\n\n### Add Continent\n\n#### Making continent lists\n\n\n::: {.cell}\n\n```{.r .cell-code}\nEurope  <- c('France', \"Belgium\", 'Yugoslavia', 'Romania', 'Sweden', 'Austria', 'Germany', 'Spain', 'Czechoslovakia', 'Hungary', 'Italy', 'Netherlands', 'Switzerland', 'Poland', 'Norway', 'England', 'Scotland', 'West Germany', 'Turkey', 'Northern Ireland', 'Wales', 'Bulgaria', 'Portugal', 'East Germany', 'Denmark', 'Republic of Ireland', 'Greece', 'Croatia', 'FR Yugoslavia', 'Serbia', 'Slovenia', 'Czech Republic', 'Ukraine', 'Slovakia', 'Iceland', 'Bosnia and Herzegovina') \n\nAsia <- c('South Korea', 'Soviet Union', 'North Korea', 'Israel', 'Iran', 'Cameroon', 'Kuwait', 'Iraq', 'United Arab Emirates', 'Russia', 'Saudi Arabia', 'Japan', 'China PR', 'Australia', 'New Zealand')\n\nAfrica <- c('Egypt', 'Morocco', 'Zaire', 'Tunisia', 'Algeria', 'Nigeria', 'South Africa', 'Senegal', 'Ivory Coast', 'Angola', 'Ghana', 'Togo' )\n\nNorth_America <- c('Mexico', 'United States', 'Cuba', 'Dutch West Indies', 'Haiti', 'El Salvador', \"Honduras\", 'Canada', 'Costa Rica', 'Jamaica', 'Trinidad and Tobago', 'Panama')\n\nSouth_America <- c('Brazil', 'Peru', 'Argentina', 'Chile', 'Bolivia', 'Paraguay', 'Uruguay', 'Colombia','Ecuador')\n```\n:::\n\n\n### Make continent variable\n\n\n::: {.cell}\n\n```{.r .cell-code}\nq2 <- q2 %>%\n  mutate(continent =\n           case_when(team %in% Europe ~ 'Europe',\n                     team %in% Asia ~ 'Asia/Oceania',\n                     team %in% South_America ~ 'South America',\n                     team %in% North_America ~ 'North America',\n                     team %in% Africa ~ 'Africa',\n                     TRUE ~ 'Other'))\n\nq2_else <- q2 %>%\n  mutate(continent = \n           case_when(continent == 'Europe' ~ 'Europe',\n                     TRUE ~ 'Non-european')\n  )\n```\n:::\n\n\n### Early graphs\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncontinent_per_year <- q2 %>%\n  group_by(year, continent) %>%\n  summarize(teams = unique(team)) %>%\n  group_by(year, continent) %>%\n  summarize(count_per_continent = n())\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'year', 'continent'. You can override using\nthe `.groups` argument.\n`summarise()` has grouped output by 'year'. You can override using the\n`.groups` argument.\n```\n:::\n\n```{.r .cell-code}\nfreq <- continent_per_year %>%\n  group_by(year) %>%\n  mutate(total = sum(count_per_continent),\n         pct = count_per_continent/total) \n\ncontinent_per_year_else <- q2_else %>%\n  group_by(year, continent) %>%\n  summarize(teams = unique(team)) %>%\n  group_by(year, continent) %>%\n  summarize(count_per_continent = n())\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'year', 'continent'. You can override using\nthe `.groups` argument.\n`summarise()` has grouped output by 'year'. You can override using the\n`.groups` argument.\n```\n:::\n\n```{.r .cell-code}\nfreq_else <- continent_per_year_else %>%\n  group_by(year) %>%\n  mutate(total = sum(count_per_continent),\n         pct = count_per_continent/total) \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(freq, aes(x = year, y = pct, color = continent)) +\n  geom_point(size = .2) +\n  geom_line() +\n  theme_minimal() +\n  labs(\n    x = 'Year',\n    y = 'Percentage of teams in WC',\n    title = 'Percentage of world cup teams from each continent',\n    subtitle = 'by year',\n    color = 'Continent'\n  ) +\n  scale_color_manual(values = c(\"#1077C3\", \"#FEC310\", \"#49BCE3\", \"#56042C\", \"#A80040\")) +\n  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +\n  geom_rect(\n    xmin = 1982.25,\n    xmax = 1995,\n    ymin = 0.74,\n    ymax = 0.81,\n    fill = \"white\",\n    color = \"black\",\n    size = 0.2\n  ) +\n  geom_vline(xintercept = 1982,\n             linetype = \"dashed\",\n             color = \"red\") +\n  annotate(\n    \"text\",\n    x = 1982.35,\n    y = 0.8,\n    label = \"Number of teams\\nincreased to 24\",\n    size = 2,\n    color = \"black\",\n    hjust = 0,\n    vjust = 1\n  ) +\n  annotate(\n    \"text\",\n    x = 1982,\n    y = 1,\n    label = \"1982\",\n    size = 4,\n    color = \"red\",\n    hjust = -0.1,\n    vjust = 1,\n    fontface = \"bold\"\n  ) +\n  geom_rect(\n    xmin = 1998.25,\n    xmax = 2011,\n    ymin = 0.74,\n    ymax = 0.81,\n    fill = \"white\",\n    color = \"black\",\n    size = 0.2\n  ) +\n  geom_vline(xintercept = 1998,\n             linetype = \"dashed\",\n             color = \"red\") +\n  annotate(\n    \"text\",\n    x = 1998.35,\n    y = 0.8,\n    label = \"Number of teams\\nincreased to 32\",\n    size = 2,\n    color = \"black\",\n    hjust = 0,\n    vjust = 1\n  ) +\n  annotate(\n    \"text\",\n    x = 1998,\n    y = 1,\n    label = \"1998\",\n    size = 4,\n    color = \"red\",\n    hjust = -0.1,\n    vjust = 1,\n    fontface = \"bold\"\n  ) +\n  theme(plot.margin = margin(10, 10, 30, 10))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nâ„¹ Please use `linewidth` instead.\n```\n:::\n\n::: {.cell-output-display}\n![](Code_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(freq_else, aes(x = year, y = pct, color = continent)) + \n  geom_point(size = .2) +\n  geom_line() +\n  theme_minimal() + \n  labs(x = 'Year', y = 'Percentage of teams in WC', title = 'Percentage of world cup teams from Europe', subtitle = 'by year', color = 'Continent') +\n  scale_color_manual(values = c(\"#49BCE3\", \"darkgreen\")) + \n  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +\n  geom_hline(yintercept=0.5,linetype=2)\n```\n\n::: {.cell-output-display}\n![](Code_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n### Question 2: Plot 2\n\nWe plan to make a segmented frequency bar chart with the rounds ordered on the x axis from beginning to later rounds, filled by continent, and faceted by decade. The purpose of faceting by decade (or every two decades) is we get to see how representation across the world cup stages has changed over time.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nq2_2 <- world_cup_total |>\n  pivot_longer(\n    cols = c(home_team, away_team),\n    names_to = \"home_away\",\n    values_to = \"team\"\n  ) |>\n  mutate(\n    continent = case_when(\n      team %in% Africa ~ \"Africa\",\n      team %in% Asia ~ \"Asia\",\n      team %in% North_America ~ \"North America\",\n      team %in% South_America ~ \"South America\",\n      team %in% Europe ~ \"Europe\",\n      TRUE ~ \"Other\"\n    ),\n    rounds = case_when(\n      str_detect(stage, \"Group\") ~ \"Group\",\n      stage %in% c(\"Round of 16\") ~ \"Round 16\",\n      stage == \"Quarterfinals\" ~ \"Quarters\",\n      stage == \"Semifinals\" ~ \"Semis\",\n      stage == \"Final Round\" & \n        winning_team == \"Sweden\" & losing_team == \"Spain\" ~ \"Third\",\n      stage == \"Third place\" ~ \"Third\",\n      stage == \"Final Round\" & \n        winning_team == \"Uruguay\" & losing_team == \"Brazil\" ~ \"Final\",\n      stage == \"Final\" ~ \"Final\",\n      TRUE ~ \"Semis\"\n    ),\n    # changed to be 20 years\n    decade = case_when(\n      year %in% 1930:1949 ~ \"1930s/40s\",\n      #year %in% 1940:1949 ~ \"1940s\",\n      year %in% 1950:1969 ~ \"1950s/60s\",\n      #year %in% 1960:1969 ~ \"1960s\",\n      year %in% 1970:1989 ~ \"1970s/80s\",\n      #year %in% 1980:1989 ~ \"1980s\",\n      year %in% 1990:2009 ~ \"1990/00s\",\n      #year %in% 2000:2009 ~ \"2000s\",\n      year %in% 2010:2029 ~ \"2010s/20s\"\n      #year %in% 2020:2029 ~ \"2020s\",\n    )\n  ) |>\n  mutate(\n    rounds = fct_relevel(rounds, \"Group\", \"Round 16\", \"Quarters\", \n                         \"Semis\", \"Third\", \"Final\")\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Exclude \"Third\" from the levels of the factor variable \"rounds\"\nq2_2_no_third <- q2_2 %>% filter(rounds != \"Third\")\n\n# Reorder the factor levels of the \"continent\" variable\nq2_2_no_third$continent <- fct_relevel(q2_2_no_third$continent, \n                                        \"Other\", \"Africa\", \n                                        \"North America\", \"Asia\", \"South America\", \n                                        \"Europe\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: 1 unknown level in `f`: Other\n```\n:::\n\n```{.r .cell-code}\n# Create the stacked bar plot\nq2_2_no_third |>\n  ggplot(aes(x = rounds, fill = continent)) +\n    geom_bar(position = \"fill\") +\n    facet_wrap(~decade, nrow = 1) +\n    theme_minimal() +\n    labs(\n      title = \"Representation from Continents Across World Cup Rounds\",\n      subtitle = \"By Decade\",\n      x = \"Round\",\n      y = \"Proportion of all teams\",\n      fill = \"Continent\"\n    ) +\n    theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.7),\n          strip.text.x = element_text(face = \"bold\"),\n          legend.title = element_text(size = 12),\n          legend.text = element_text(size = 10)) +\n  scale_fill_manual(values = c(\"#49BCE3\", \"#A80040\", \"#FEC310\", \"#56042C\", \"#1077C3\"))\n```\n\n::: {.cell-output-display}\n![](Code_files/figure-html/q2_plot2-1.png){width=1920}\n:::\n:::\n",
    "supporting": [
      "Code_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}