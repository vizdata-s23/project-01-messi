---
title: "The Evolution of the World Cup"
subtitle: "STA/ISS 313 - Project 1"
author: "Team Messi"
format: html
editor: visual
execute:
  echo: false
---

## Abstract

(1 paragraph): Project abstract.

------------------------------------------------------------------------

## Introduction

(1-2 paragraphs): Brief introduction to the dataset. You may repeat some of the information about the dataset provided in the introduction to the dataset on the TidyTuesday repository, paraphrasing on your own terms. Imagine that your project is a standalone document and the grader has no prior knowledge of the dataset.

## Question 1: The Effect of New Rules on Goals Scored

### Introduction

Throughout the World Cup's history, many new rules and technologies have been implemented, changing the way soccer is played. This includes the introduction of penalties for tie breaking, VAR to contest calls on the field, increasing the number of teams in each World Cup, and many more. These factors affect how teams play and have forced players to adapt their strategies. In order to assess the impact caused to the overall game, the most straightforward metric to consider is the number of goals scored. Although the score can oversimplify a very complex game, many important decisions are made from it, including which countries make it into the World Cup and ultimately win the tournament. We, as soccer fans, have decided to analyze goals because it is unarguably the most important and entertaining part of the game.

To explore our question, we will be using the `wcmatches` and `worldcups` datasets from TidyTuesday, and merging in external data from Kaggle containing specifics into penalty kicks taken during the World Cups. Specifically, we will be looking at the variables with year, goals per game, penalties awarded and penalties scored, as well as created variables indicating the implementation of a new rule or a notable event. We will be analyzing both the broad concept of total goals scored as well as penalty kicks. Penalties are a very controversial and powerful part of soccer. For perspective, 3 World Cup finals have been decided by penalty shootouts. To see how the game has been affected since the introduction of penalties in 1970, we will be analyzing the number of penalties awarded and scored over time. This, in conjunction with the rules implemented, will give us insight into how penalties have affected scores and how players have adapted to the changing rules.

### Approach

(1-2 paragraphs): Describe what types of plots you are going to make to address your question. For each plot, provide a clear explanation as to why this plot (e.g. boxplot, barplot, histogram, etc.) is best for providing the information you are asking about. The two plots should be of different types, and at least one of the two plots needs to use either color mapping or facets.

For the first plot, we will be making a scatterplot showing the goals scored per game during each World Cup. This will make any trends over time very visible and allow for our annotations, which will hopefully reveal more information. We are going to indicate years, using the shape and color of points, in which a new rule or notable event occurred and provide a brief description. Through this, we hope to provide reasoning for long and short-term trends in the plot.

### Analysis

(2-3 code blocks, 2 figures, text/code comments as needed): In this section, provide the code that generates your plots. Use scale functions to provide nice axis labels and guides. You are welcome to use theme functions to customize the appearance of your plot, but you are not required to do so. All plots must be made with **ggplot2**. Do not use base R or lattice plotting functions.

### Discussion

(1-3 paragraphs): In the Discussion section, interpret the results of your analysis. Identify any trends revealed (or not revealed) by the plots. Speculate about why the data looks the way it does.

## Question 2: Representation of Non-European and South American Teams in the World Cup

### Introduction

(1-2 paragraphs): Introduction to the question and what parts of the dataset are necessary to answer the question. Also discuss why you're interested in this question.

Back during the conception of the world cup, despite the 'world' name, it was dominated by European and South American teams. The world cup had very little representation from Asia, Africa and Oceania. (add more context).

To explore our question, we will use the `wcmatches` and `worldcups` datasets from TidyTuesday and merge them by the year of the world cup in order to bring over the information for each world cup to each world cup match. To measure representation from Non-European and South American Teams, we created a variable `continent` based off of the countries of the teams with the levels Africa, Asia, Europe, North America, South America, and Other. For our plots, we visualized how the representation of teams from the different continents have changed throughout the World Cup over time.

### Approach

(1-2 paragraphs): Describe what types of plots you are going to make to address your question. For each plot, provide a clear explanation as to why this plot (e.g. boxplot, barplot, histogram, etc.) is best for providing the information you are asking about. The two plots should be of different types, and at least one of the two plots needs to use either color mapping or facets.

For our second plot, we will make a segmented relative frequency barplot to illustrate how the representation from Non-European and South American teams change across the World Cup rounds and over time. Since we want to explore the relative proportions of teams from each continent across the World Cup stages, we thought it was best to use a segmented relative frequency barplot to allow for straightforward and direct comparison across groups. In addition, we chose to look at relative frequencies rather than counts since the number of teams varies for each round of the World Cup. We will order the rounds on the y axis from the beginning round (Group) to the final round (Final) and fill by continent. We will facet by every two decades since we can explore how the representation across rounds of the World Cup change over time and see this trend for all World Cups in history.

### Analysis

(2-3 code blocks, 2 figures, text/code comments as needed): In this section, provide the code that generates your plots. Use scale functions to provide nice axis labels and guides. You are welcome to use theme functions to customize the appearance of your plot, but you are not required to do so. All plots must be made with **ggplot2**. Do not use base R or lattice plotting functions.

```{r}
#| label: q2_plot2_dataprep

q2_2 <- world_cup_total |>
  pivot_longer(
    cols = c(home_team, away_team),
    names_to = "home_away",
    values_to = "team"
  ) |>
  mutate(
    continent = case_when(
      team %in% Africa ~ "Africa",
      team %in% Asia ~ "Asia",
      team %in% North_America ~ "North America",
      team %in% South_America ~ "South America",
      team %in% Europe ~ "Europe",
      TRUE ~ "Other"
    ),
    rounds = case_when(
      str_detect(stage, "Group") ~ "Group",
      stage %in% c("Round of 16") ~ "Round 16",
      stage == "Quarterfinals" ~ "Quarters",
      stage == "Semifinals" ~ "Semis",
      stage == "Final Round" & 
        winning_team == "Sweden" & losing_team == "Spain" ~ "Third",
      stage == "Third place" ~ "Third",
      stage == "Final Round" & 
        winning_team == "Uruguay" & losing_team == "Brazil" ~ "Final",
      stage == "Final" ~ "Final",
      TRUE ~ "Semis"
    ),
    # changed to be 20 years
    decade = case_when(
      year %in% 1930:1949 ~ "1930s/40s",
      #year %in% 1940:1949 ~ "1940s",
      year %in% 1950:1969 ~ "1950s/60s",
      #year %in% 1960:1969 ~ "1960s",
      year %in% 1970:1989 ~ "1970s/80s",
      #year %in% 1980:1989 ~ "1980s",
      year %in% 1990:2009 ~ "1990/00s",
      #year %in% 2000:2009 ~ "2000s",
      year %in% 2010:2029 ~ "2010s/20s"
      #year %in% 2020:2029 ~ "2020s",
    )
  )
```

```{r}
#| label: fig-q2-plot2
#| warning: false

# Exclude "Third" from the levels of the factor variable "rounds"
q2_2_no_third <- q2_2 %>% filter(rounds != "Third")

# Reorder the factor levels of the "continent" variable
q2_2_no_third$continent <- fct_relevel(q2_2_no_third$continent, 
                                        "Other", "Africa", 
                                        "North America", "Asia", "South America", 
                                        "Europe")

# Create the stacked bar plot
q2_2_no_third |>
  mutate(
    rounds = fct_relevel(rounds, "Final", "Semis", "Quarters", "Round 16", "Group")
  ) |>
  ggplot(aes(x = rounds, fill = continent)) +
    geom_bar(position = "fill") +
    # facet_wrap(~decade, ncol = 1) +
    facet_grid(decade~.) +
    theme_minimal() +
    coord_flip() +
    labs(
      title = "European and South American Teams Dominating Later Rounds",
      x = "Rounds of the World Cup",
      y = "Proportion",
      fill = "Continent"
    ) +
    theme(axis.text.x = element_text(vjust = 0.7, face = "bold"),
          strip.text.y = element_text(angle = 360, face = "bold"),
          legend.title = element_text(size = 12),
          legend.text = element_text(size = 10),
          axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
          axis.title.x = element_text(margin = margin(t = 15, r = 0, b = 0, l = 0))) +
  scale_fill_manual(values = c("#e29578", "#56042C", "#F2CC8F", "#006d77", "#83c5be")) 
```

### Discussion

(1-3 paragraphs): In the Discussion section, interpret the results of your analysis. Identify any trends revealed (or not revealed) by the plots. Speculate about why the data looks the way it does.
